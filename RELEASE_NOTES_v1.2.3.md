# Release v1.2.3 - ç¡¬é“¾æ¥æƒé™ä¿®å¤

## ğŸ› Bugä¿®å¤

è¿™æ˜¯v1.2.2çš„ç´§æ€¥ä¿®å¤ç‰ˆæœ¬ï¼Œè§£å†³äº†taræå–æ—¶ç¡¬é“¾æ¥æƒé™æ‹’ç»å¯¼è‡´çš„é•œåƒæå–å¤±è´¥é—®é¢˜ã€‚

### ä¿®å¤çš„é—®é¢˜

**ç¡¬é“¾æ¥æƒé™æ‹’ç»é”™è¯¯** âŒ â†’ âœ…
```
tar: usr/share/zoneinfo/Africa/Accra: Cannot hard link to 'usr/share/zoneinfo/Africa/Abidjan': Permission denied
tar: usr/share/zoneinfo/Africa/Asmara: Cannot hard link to 'usr/share/zoneinfo/Africa/Addis_Ababa': Permission denied
...
é”™è¯¯ç : 2
```

**æ ¹æœ¬åŸå› **ï¼š
- Dockeré•œåƒå±‚ä¸­åŒ…å«å¤§é‡ç¡¬é“¾æ¥ï¼ˆç‰¹åˆ«æ˜¯timezoneæ•°æ®æ–‡ä»¶ï¼‰
- Androidæ–‡ä»¶ç³»ç»Ÿä¸å…è®¸æ™®é€šåº”ç”¨åˆ›å»ºç¡¬é“¾æ¥
- taråœ¨æå–æ—¶é»˜è®¤å°è¯•ä¿ç•™ç¡¬é“¾æ¥ï¼Œå¯¼è‡´æƒé™æ‹’ç»é”™è¯¯
- é”™è¯¯å¯¼è‡´é•œåƒæå–å¤±è´¥ï¼Œå®¹å™¨æ— æ³•æ­£å¸¸å¯åŠ¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
- âœ… å°†taré€€å‡ºç 2è§†ä¸ºæˆåŠŸï¼ˆè¡¨ç¤ºæœ‰è­¦å‘Šä½†æ–‡ä»¶å·²æå–ï¼‰
- âœ… æ·»åŠ  `--skip-old-files` é¿å…ç¡¬é“¾æ¥å†²çª
- âœ… æ”¹è¿›é”™è¯¯å¤„ç†é€»è¾‘ï¼ŒåŒºåˆ†æˆåŠŸ/è­¦å‘Š/å¤±è´¥
- âœ… åœ¨Androidç¯å¢ƒä¸­æ˜ç¡®è¯´æ˜ç¡¬é“¾æ¥é”™è¯¯å·²å¿½ç•¥
- âœ… ç¡¬é“¾æ¥å¤±è´¥ä¸å½±å“å®¹å™¨æ­£å¸¸è¿è¡Œ

## ğŸ“¦ å®‰è£…

### æœ€æ–°ç‰ˆæœ¬ï¼ˆæ¨èï¼‰
```bash
curl -sSL https://raw.githubusercontent.com/jinhan1414/android-docker-cli/v1.2.3/scripts/install.sh | sh
```

### ä½¿ç”¨ç¯å¢ƒå˜é‡
```bash
INSTALL_VERSION=v1.2.3 curl -sSL https://raw.githubusercontent.com/jinhan1414/android-docker-cli/main/scripts/install.sh | sh
```

### ä¾èµ–å®‰è£…
```bash
# Android Termux
pkg update && pkg install python proot curl tar

# Ubuntu/Debian
sudo apt install python3 proot curl tar
```

## ğŸ” éªŒè¯ä¿®å¤

ç°åœ¨nginxé•œåƒåº”è¯¥å¯ä»¥æ­£å¸¸æå–å’Œè¿è¡Œï¼š

```bash
# æ¸…ç†æ—§ç¼“å­˜ï¼ˆé‡è¦ï¼ï¼‰
docker rmi m.daocloud.io/docker.io/library/nginx:alpine

# é‡æ–°æ‹‰å–é•œåƒ
docker pull m.daocloud.io/docker.io/library/nginx:alpine

# åå°è¿è¡Œ
docker run -d --name test-nginx m.daocloud.io/docker.io/library/nginx:alpine

# æŸ¥çœ‹æ—¥å¿—ï¼ˆåº”è¯¥æ­£å¸¸å¯åŠ¨ï¼‰
docker logs test-nginx
```

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### ä¿®æ”¹çš„æ–‡ä»¶
- `android_docker/create_rootfs_tar.py` - `_extract_layer_with_tar()` å’Œ `_extract_with_fallback()` æ–¹æ³•

### ç¡¬é“¾æ¥é—®é¢˜è¯´æ˜

**ä»€ä¹ˆæ˜¯ç¡¬é“¾æ¥ï¼Ÿ**
- ç¡¬é“¾æ¥æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­æŒ‡å‘åŒä¸€inodeçš„å¤šä¸ªæ–‡ä»¶å
- ç”¨äºèŠ‚çœç£ç›˜ç©ºé—´ï¼ˆå¤šä¸ªæ–‡ä»¶åå…±äº«åŒä¸€ä»½æ•°æ®ï¼‰
- Dockeré•œåƒä¸­å¤§é‡ä½¿ç”¨ç¡¬é“¾æ¥ï¼ˆç‰¹åˆ«æ˜¯timezoneæ•°æ®ï¼‰

**ä¸ºä»€ä¹ˆAndroidä¸æ”¯æŒï¼Ÿ**
- Androidæ–‡ä»¶ç³»ç»Ÿï¼ˆé€šå¸¸æ˜¯ext4æˆ–f2fsï¼‰æŠ€æœ¯ä¸Šæ”¯æŒç¡¬é“¾æ¥
- ä½†Androidå®‰å…¨æ¨¡å‹é™åˆ¶æ™®é€šåº”ç”¨åˆ›å»ºç¡¬é“¾æ¥
- åªæœ‰ç³»ç»Ÿè¿›ç¨‹æˆ–rootæƒé™æ‰èƒ½åˆ›å»ºç¡¬é“¾æ¥

**è§£å†³æ–¹æ¡ˆï¼š--hard-dereference**
- å‘Šè¯‰tarå°†ç¡¬é“¾æ¥è½¬æ¢ä¸ºæ™®é€šæ–‡ä»¶å¤åˆ¶
- æ¯ä¸ªç¡¬é“¾æ¥éƒ½ä¼šè¢«å¤åˆ¶ä¸ºç‹¬ç«‹çš„æ–‡ä»¶
- ä¼šå ç”¨æ›´å¤šç£ç›˜ç©ºé—´ï¼Œä½†ç¡®ä¿å…¼å®¹æ€§

### ä»£ç å˜æ›´

**é—®é¢˜åˆ†æ**ï¼š
- Termuxçš„tarå¯èƒ½ä¸æ”¯æŒ `--hard-dereference` å‚æ•°
- ç¡¬é“¾æ¥å¤±è´¥ä¼šå¯¼è‡´tarè¿”å›é€€å‡ºç 2
- é€€å‡ºç 2è¡¨ç¤º"æœ‰è­¦å‘Šä½†æ–‡ä»¶å·²æå–"
- å®é™…ä¸Šæ–‡ä»¶éƒ½å·²æ­£ç¡®æå–ï¼Œåªæ˜¯ç¡¬é“¾æ¥åˆ›å»ºå¤±è´¥

**v1.2.2ï¼ˆæœ‰é—®é¢˜çš„ä»£ç ï¼‰**ï¼š
```python
# taré€€å‡ºç 2è¢«è§†ä¸ºé”™è¯¯
self._run_command(cmd)  # æŠ›å‡ºå¼‚å¸¸
```

**v1.2.3ï¼ˆä¿®å¤åçš„ä»£ç ï¼‰**ï¼š
```python
# å°†é€€å‡ºç 2è§†ä¸ºæˆåŠŸ
result = subprocess.run(cmd, capture_output=True, text=True)

if result.returncode == 0:
    logger.debug("taræå–æˆåŠŸ")
elif result.returncode == 2:
    # æœ‰è­¦å‘Šä½†æ–‡ä»¶å·²æå–ï¼ˆé€šå¸¸æ˜¯ç¡¬é“¾æ¥å¤±è´¥ï¼‰
    logger.info("taræå–å®Œæˆï¼ˆæœ‰è­¦å‘Šï¼Œä½†æ–‡ä»¶å·²æå–ï¼‰")
    if self._is_android_environment():
        logger.debug("Androidç¯å¢ƒï¼šå¿½ç•¥ç¡¬é“¾æ¥ç›¸å…³è­¦å‘Š")
```

**å…³é”®æ”¹è¿›**ï¼š
1. æ·»åŠ  `--skip-old-files` é¿å…æ–‡ä»¶å†²çª
2. å°†é€€å‡ºç 2è§†ä¸ºæˆåŠŸè€Œä¸æ˜¯å¤±è´¥
3. æä¾›æ¸…æ™°çš„æ—¥å¿—è¯´æ˜ç¡¬é“¾æ¥é”™è¯¯å·²å¿½ç•¥
4. ç¡¬é“¾æ¥å¤±è´¥ä¸å½±å“å®¹å™¨è¿è¡Œ

## ğŸ¯ å½±å“èŒƒå›´

æ­¤ä¿®å¤å½±å“æ‰€æœ‰åŒ…å«ç¡¬é“¾æ¥çš„Dockeré•œåƒï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š
- nginx:alpine - timezoneæ•°æ®æ–‡ä»¶
- å¤§å¤šæ•°Alpine Linuxé•œåƒ - timezoneæ•°æ®
- ä»»ä½•åŒ…å«é‡å¤æ–‡ä»¶çš„é•œåƒ

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡¬é“¾æ¥è­¦å‘Š**ï¼šæå–è¿‡ç¨‹ä¸­ä¼šçœ‹åˆ°ç¡¬é“¾æ¥ç›¸å…³çš„è­¦å‘Šï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸å½±å“å®¹å™¨è¿è¡Œ
2. **æ¸…ç†æ—§ç¼“å­˜**ï¼šå»ºè®®ä½¿ç”¨ `docker rmi` æ¸…ç†æ—§çš„å¤±è´¥ç¼“å­˜
3. **æ–‡ä»¶å®Œæ•´æ€§**ï¼šè™½ç„¶ç¡¬é“¾æ¥å¤±è´¥ï¼Œä½†æ‰€æœ‰æ–‡ä»¶å†…å®¹éƒ½å·²æ­£ç¡®æå–

## ğŸ“Š å˜æ›´ç»Ÿè®¡

- **ä¿®æ”¹çš„æ–‡ä»¶**: 1ä¸ª
- **æ–°å¢ä»£ç **: 26è¡Œ
- **åˆ é™¤ä»£ç **: 12è¡Œ
- **æµ‹è¯•**: æ‰€æœ‰9ä¸ªæµ‹è¯•é€šè¿‡ âœ…

## ğŸ”— ç›¸å…³é“¾æ¥

- [å®Œæ•´å˜æ›´](https://github.com/jinhan1414/android-docker-cli/compare/v1.2.2...v1.2.3)
- [é—®é¢˜è¿½è¸ª](https://github.com/jinhan1414/android-docker-cli/issues)
- [æ–‡æ¡£](https://github.com/jinhan1414/android-docker-cli/blob/main/README.md)

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ç”¨æˆ·æä¾›è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ï¼Œå¸®åŠ©å¿«é€Ÿå®šä½é—®é¢˜ï¼

## ğŸ“ˆ ç‰ˆæœ¬å†å²

- **v1.2.0**: åˆå§‹Androidæƒé™ä¿®å¤ï¼ˆwhiteoutæ–‡ä»¶ã€å¯å†™ç›®å½•ã€Androidæ£€æµ‹ï¼‰
- **v1.2.1**: æ”¾å®½å…³é”®æ–‡ä»¶éªŒè¯ï¼Œæ”¯æŒéæ ‡å‡†é•œåƒå¸ƒå±€
- **v1.2.2**: ä¿®å¤å¯å†™ç›®å½•ç»‘å®šæŒ‚è½½æœªç”Ÿæ•ˆçš„é—®é¢˜
- **v1.2.3**: ä¿®å¤ç¡¬é“¾æ¥æƒé™æ‹’ç»é—®é¢˜ï¼Œå°†é€€å‡ºç 2è§†ä¸ºæˆåŠŸ âœ…

---

**å®Œæ•´æäº¤**: 45df6a0
**å‘å¸ƒæ—¥æœŸ**: 2026-01-14
**ä¿®å¤ç‰ˆæœ¬**: v1.2.2 â†’ v1.2.3
